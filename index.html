<!DOCTYPE html>
<html>
  <head>
    <title>Share My Location</title>
    <script>
      // Function to extract query parameters from the URL
      function getQueryParameter(name) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(name);
      }

      function sendLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            function (position) {
              const latitude = position.coords.latitude;
              const longitude = position.coords.longitude;

              // Replace this with your Make.com Webhook URL
              const webhookUrl = "https://hook.us2.make.com/2mwqx4zc6jtx9pr4ycrw9pwimsil37vo";

              // Dynamically extract user_id (if passed as a query parameter)
              const userId = getQueryParameter("user_id") || "unknown";

              console.log("Latitude:", latitude, "Longitude:", longitude, "User ID:", userId); // Debugging

              // Send the data to your webhook
              fetch(webhookUrl, {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  latitude: latitude,
                  longitude: longitude,
                  user_id: userId,
                }),
              })
                .then((response) => {
                  if (response.ok) {
                    alert("Location sent successfully!");
                    window.close(); // Close the page after sending location
                  } else {
                    console.error("Failed to send location:", response.statusText); // Debugging
                    alert("Failed to send location. Please try again.");
                  }
                })
                .catch((error) => {
                  console.error("Fetch error:", error.message); // Debugging
                  alert("Error: " + error.message);
                });
            },
            function (error) {
              console.error("Error getting location:", error.message); // Debugging
              alert(
                "Error getting location: " +
                  (error.message || "Please allow location access.")
              );
              window.close();
            }
          );
        } else {
          alert("Geolocation is not supported by this browser.");
          console.error("Geolocation not supported."); // Debugging
          window.close();
        }
      }
    </script>
  </head>
  <body onload="sendLocation()">
    <h1>Sharing Location...</h1>
    <p>Please allow location access.</p>
  </body>
</html>
